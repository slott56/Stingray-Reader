<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. Cell Module – Data Element Containers and Conversions &mdash; The Stingray Schema-Based File Reader</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '4.4.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="The Stingray Schema-Based File Reader" href="index.html" />
    <link rel="next" title="5. Sheet Module – Sheet and Row Access" href="sheet.html" />
    <link rel="prev" title="3.1. stingray __init__.py" href="stingray_init.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sheet.html" title="5. Sheet Module – Sheet and Row Access"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="stingray_init.html" title="3.1. stingray __init__.py"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">The Stingray Schema-Based File Reader</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-cell">
<span id="cell-module-data-element-containers-and-conversions"></span><span id="cells"></span><h1>4. Cell Module &#8211; Data Element Containers and Conversions<a class="headerlink" href="#module-cell" title="Permalink to this headline">¶</a></h1>
<p>The point of a <a class="reference internal" href="#cell.Cell" title="cell.Cell"><tt class="xref py py-class docutils literal"><span class="pre">cell.Cell</span></tt></a> is two-fold.</p>
<ul class="simple">
<li><strong>Capture</strong>.  That is, decode the information in the source file into
a Python object that represents the source spreadsheet value.
For XLS or XLSX formats, there are a variety of cell data types.
For CSV, all cells are text.
For a fixed format file, we may have to exploit the physical format information
to properly decode the bytes or characters.  We may even have to
cope with EBCDIC or packed decimal conversions.</li>
<li><strong>Convert</strong>. Provide the cell value coerced to another type.</li>
</ul>
<div class="section" id="capture-use-case">
<h2>4.1. Capture Use Case<a class="headerlink" href="#capture-use-case" title="Permalink to this headline">¶</a></h2>
<p>The <strong>Capture</strong> use case is defined by our physical formats.
<tt class="docutils literal"><span class="pre">xlrd</span></tt> identifies the follow cell types found in XLS workbooks.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="5%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type symbol</th>
<th class="head">Type number</th>
<th class="head">Python value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>XL_CELL_EMPTY</td>
<td>0</td>
<td>empty string &#8216;&#8217;</td>
</tr>
<tr class="row-odd"><td>XL_CELL_TEXT</td>
<td>1</td>
<td>a Unicode string</td>
</tr>
<tr class="row-even"><td>XL_CELL_NUMBER</td>
<td>2</td>
<td>float</td>
</tr>
<tr class="row-odd"><td>XL_CELL_DATE</td>
<td>3</td>
<td>float</td>
</tr>
<tr class="row-even"><td>XL_CELL_BOOLEAN</td>
<td>4</td>
<td>int; 1 means TRUE, 0 means FALSE</td>
</tr>
<tr class="row-odd"><td>XL_CELL_ERROR</td>
<td>5</td>
<td>int representing internal Excel codes; for a text representation, refer to the supplied dictionary error_text_from_code</td>
</tr>
<tr class="row-even"><td>XL_CELL_BLANK</td>
<td>6</td>
<td>empty string &#8216;&#8217;. Note: this type will appear only when open_workbook(..., formatting_info=True) is used.</td>
</tr>
</tbody>
</table>
<p>An XLSX (per ECMA 376, section 18.18.11) or ODS provides a similar list of cell types.  The data is always encoded as a proper string that can be converted (if necessary) based on the type code.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Enumeration Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">b</span></tt> (Boolean)</td>
<td>Cell containing a boolean.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">d</span></tt> (Date)</td>
<td>Cell contains a date in the ISO 8601 format.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">e</span></tt> (Error)</td>
<td>Cell containing an error.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">inlineStr</span></tt> (Inline String)</td>
<td>Cell containing an (inline) rich string, i.e., one not in the shared string table. If this cell type is used, then the cell value is in the is element rather than the v element in the cell (c element).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">n</span></tt> (Number)</td>
<td>Cell containing a number.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">s</span></tt> (Shared String)</td>
<td>Cell containing a shared string.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">str</span></tt> (String)</td>
<td>Cell containing a formula string.</td>
</tr>
</tbody>
</table>
<p>Dates formatted as strings are &#8211; always &#8211; a problem. There&#8217;s no generic solution.  An application may need to write suitable extensions to handle this.
See below under <a class="reference internal" href="#conversion-functions">Conversion Functions</a>.</p>
<p>We should depend on the <tt class="xref py py-mod docutils literal"><span class="pre">locale</span></tt> module to provide proper format strings for converting between date and string.</p>
<p>A Numbers spreadsheet appears to have the following cell types. Some of the
tags appear to have no value, so their purpose is unclear.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Tag</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">d</span></tt> (Date)</td>
<td>Cell containing a date</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">f</span></tt> (Formula)</td>
<td>Cell containing a formula</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">g</span></tt> (Empty)</td>
<td>Two or more empty cells</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">n</span></tt> (Number)</td>
<td>Cell containing a number</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">o</span></tt> (?)</td>
<td>One empty cell</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">s</span></tt> (?)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">t</span></tt> (Text)</td>
<td>Cell containing text</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">pm</span></tt> (Popup Menu)</td>
<td>A popup menu of otherc cell values</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="convert-use-cases">
<h2>4.2. Convert Use Cases<a class="headerlink" href="#convert-use-cases" title="Permalink to this headline">¶</a></h2>
<p>There are several use cases for output conversion (or &#8220;transformation&#8221;).</p>
<ul class="simple">
<li>Trivial.  <tt class="docutils literal"><span class="pre">float</span></tt>, <tt class="docutils literal"><span class="pre">str</span></tt> or an empty cell.  Essentially,
we&#8217;re using the captured data type directly.</li>
<li>Easy.  <tt class="docutils literal"><span class="pre">float</span></tt> or <tt class="docutils literal"><span class="pre">str</span></tt> to <tt class="docutils literal"><span class="pre">decimal</span></tt>.  Generally,  currency
fields are stored as <tt class="docutils literal"><span class="pre">float</span></tt> in the workbook; this needs to be coverted to
<tt class="docutils literal"><span class="pre">decimal</span></tt> to be useful.</li>
<li>Obscure.  <tt class="docutils literal"><span class="pre">datetime</span></tt> based on <tt class="docutils literal"><span class="pre">float</span></tt>.  <tt class="docutils literal"><span class="pre">xlrd</span></tt> handles
this elegantly.</li>
<li>Variable.  <tt class="docutils literal"><span class="pre">datetime</span></tt> based on <tt class="docutils literal"><span class="pre">str</span></tt>.  The variability
becomes rather  complex.  It&#8217;s also application-specific, since
it depends on the source of the data.</li>
<li>Horrible.  Digit strings.  US Zip codes.  Social Security Numbers.
Phone numbers without punctuation.  These are digit strings which
a spreadsheet application may transform to a floating point number;
these need to be rebuilt as proper digit strings with leading zeroes.</li>
</ul>
<p>We&#8217;d like code that looks like these examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&quot;{0} has {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">foo</span><span class="o">.</span><span class="n">to_str</span><span class="p">(),</span> <span class="n">foo</span><span class="o">.</span><span class="n">to_float</span><span class="p">()</span> <span class="p">)</span>

<span class="n">today</span><span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

<span class="n">zip_code</span><span class="o">.</span><span class="n">to_digit_str</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This <strong>Convert</strong> aspect of a <a class="reference internal" href="#cell.Cell" title="cell.Cell"><tt class="xref py py-class docutils literal"><span class="pre">cell.Cell</span></tt></a> is part of <em>using</em> the logical layout.
We&#8217;ll address that under <a class="reference internal" href="developer.html#developer"><em>The Stingray Developer&#8217;s Guide</em></a>, below.</p>
</div>
<div class="section" id="model">
<h2>4.3. Model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre>http://yuml.me/diagram/scruffy;/class/
#cell,
[Cell]^[EmptyCell],
[Cell]^[TextCell],
[Cell]^[NumberCell],
[Cell]^[FloatDateCell],
[Cell]^[BooleanCell],
[Cell]^[ErrorCell].
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/cell.png"><img alt="_images/cell.png" src="_images/cell.png" style="width: 6in;" /></a>
</div>
<div class="section" id="overheads">
<h2>4.4. Overheads<a class="headerlink" href="#overheads" title="Permalink to this headline">¶</a></h2>
<p>We required <tt class="docutils literal"><span class="pre">xlrd</span></tt> from <a class="reference external" href="http://www.lexicon.net/sjmachin/xlrd.htm">http://www.lexicon.net/sjmachin/xlrd.htm</a></p>
<p>This is the easiest way to read legacy Microsoft <tt class="docutils literal"><span class="pre">.XLS</span></tt> files.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;stingray.cell -- Defines Cell as the atomic data element in a sheet</span>
<span class="sd">of a workbook.</span>

<span class="sd">A cell has a value, it&#39;s part of a workbook.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">locale</span>
<span class="kn">import</span> <span class="nn">decimal</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">xlrd</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Hashable</span>
</pre></div>
</div>
<p>Just to be sure that any locale-based processing will actually
work, we establish a default locale.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">locale</span><span class="o">.</span><span class="n">setlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_ALL</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="cell">
<h2>4.5. Cell<a class="headerlink" href="#cell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.Cell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">Cell</tt><a class="headerlink" href="#cell.Cell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#cell.Cell" title="cell.Cell"><tt class="xref py py-class docutils literal"><span class="pre">cell.Cell</span></tt></a> class hierarchy extends this base class.  Note that we have
a relatively short list of built-in conversions.
For more complex, application-specific conversions, the raw <tt class="xref py py-attr docutils literal"><span class="pre">value</span></tt> is available as a property.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span> <span class="n">Hashable</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A class hierarchy for each kind of Cell.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">workbook</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build a new Cell; the atomic data element of a  workbook.</span>

<span class="sd">        :param _value: the proper Python object, correctly converted from the source.</span>
<span class="sd">        :param workbook: the :py:class:`workbook.Workbook` that created this Cell.</span>
<span class="sd">            This is largely used for Excel date conversions, but there</span>
<span class="sd">            could be other context needs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workbook</span> <span class="o">=</span> <span class="n">value</span><span class="p">,</span> <span class="n">workbook</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;{0}({1!r})&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="ow">is</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">def</span> <span class="nf">to_digit_str</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">5</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">NotImplemented</span>
</pre></div>
</div>
<p>One feature of a cell that&#8217;s required when we do data profiling is to
create a usable hash from the cell class and raw data value.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span> <span class="o">^</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_value</span>
<span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">__class__</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_value</span>
</pre></div>
</div>
<p>We make a token effort at making a cell more-or-less immutable.  This makes it
hashable.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">value</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Test hashable interface of Cell</p>
</div>
</div>
<div class="section" id="emptycell">
<h2>4.6. EmptyCell<a class="headerlink" href="#emptycell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.EmptyCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">EmptyCell</tt><a class="headerlink" href="#cell.EmptyCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>An <tt class="docutils literal"><span class="pre">EmptyCell</span></tt> implements empty cells.  <tt class="xref py py-mod docutils literal"><span class="pre">xlrd</span></tt> may report them as a type <tt class="docutils literal"><span class="pre">XL_CELL_EMPTY</span></tt>. A Numbers spreadsheet may use the <tt class="docutils literal"><span class="pre">&lt;o&gt;</span></tt> or <tt class="docutils literal"><span class="pre">&lt;g&gt;</span></tt> tag.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">EmptyCell</span><span class="p">(</span> <span class="n">Cell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The *value* will be &#39;&#39;, but we ignore that.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
    <span class="k">def</span> <span class="nf">to_digit_str</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span> <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
<div class="section" id="textcell">
<h2>4.7. TextCell<a class="headerlink" href="#textcell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.TextCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">TextCell</tt><a class="headerlink" href="#cell.TextCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">TextCell</span></tt> implements the cells with text values.
<tt class="xref py py-mod docutils literal"><span class="pre">xlrd</span></tt> may report them as a type <tt class="docutils literal"><span class="pre">XL_CELL_TEXT</span></tt>.
It&#8217;s often possible to interpret the text as some other value,
so the conversions make reasonable attempts at that.</p>
<p>This is used for CSV workbooks as well as XLS workbooks.
This is the default type for Fixed format files, also.</p>
<p>Note that COBOL files will explicitly have bytes values, not
string values.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TextCell</span><span class="p">(</span> <span class="n">Cell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A Cell which contains a Python string value.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">format</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">format</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">nl_langinfo</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">D_FMT</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c"># Windows</span>
                <span class="n">format</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%x</span><span class="s">&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">format</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_digit_str</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">):</span>
        <span class="n">fmt</span><span class="o">=</span> <span class="s">&quot;{{0:0&gt;{0}d}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="numbercell">
<h2>4.8. NumberCell<a class="headerlink" href="#numbercell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.NumberCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">NumberCell</tt><a class="headerlink" href="#cell.NumberCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">NumberCell</span></tt> implements the cells with a float value.
<tt class="xref py py-mod docutils literal"><span class="pre">xlrd</span></tt> may report them as a type <tt class="docutils literal"><span class="pre">XL_CELL_NUMBER</span></tt>.
A variety of conversions make sense for a number value.
Note that the <tt class="docutils literal"><span class="pre">to_datetime()</span></tt> conversion depends on <tt class="docutils literal"><span class="pre">xlrd</span></tt>.
This may be a faulty assumption for some species of workbooks.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">NumberCell</span><span class="p">(</span> <span class="n">Cell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell which contains a Python float value.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="c"># likely, it&#39;s Decimal!</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">fmt</span><span class="o">=</span> <span class="s">&quot;{0:0.{digits}f}&quot;</span>
            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="n">digits</span><span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="k">assert</span> <span class="n">format</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;Format is not used.&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">=</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">xldate_as_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">workbook</span><span class="o">.</span><span class="n">datemode</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">xldate</span><span class="o">.</span><span class="n">XLDateAmbiguous</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">ex</span><span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s">&quot;Ambiguous Date: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">ex</span><span class="o">.</span><span class="n">__cause__</span><span class="o">=</span> <span class="n">e</span>
            <span class="k">raise</span> <span class="n">ex</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_digit_str</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">):</span>
        <span class="n">fmt</span><span class="o">=</span> <span class="s">&quot;{{0:0&gt;{0}d}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="floatdatecell">
<h2>4.9. FloatDateCell<a class="headerlink" href="#floatdatecell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.FloatDateCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">FloatDateCell</tt><a class="headerlink" href="#cell.FloatDateCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">FloatDateCell</span></tt> implements the cells with <tt class="docutils literal"><span class="pre">XL_CELL_DATE</span></tt>.
Since the conversions are all identical to number,
we simply inherit the features of a number.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">FloatDateCell</span><span class="p">(</span> <span class="n">NumberCell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell which contains a float value that is actually an Excel date.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Other formats have other kinds of date cells that aren&#8217;t simply
dressed-up floating-point numbers.</p>
</div>
<div class="section" id="booleancell">
<h2>4.10. BooleanCell<a class="headerlink" href="#booleancell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.BooleanCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">BooleanCell</tt><a class="headerlink" href="#cell.BooleanCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">BooleanCell</span></tt> implements the cells with <tt class="docutils literal"><span class="pre">XL_CELL_BOOLEAN</span></tt>.
Since the conversions are all identical to number,
we simply inherit the features.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">BooleanCell</span><span class="p">(</span> <span class="n">NumberCell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell which contains a boolean value.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="errorcell">
<h2>4.11. ErrorCell<a class="headerlink" href="#errorcell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.ErrorCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">ErrorCell</tt><a class="headerlink" href="#cell.ErrorCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>An <tt class="docutils literal"><span class="pre">ErrorCell</span></tt> implements the cells with <tt class="docutils literal"><span class="pre">XL_CELL_ERROR</span></tt>.
The only sensible conversion is <tt class="xref py py-meth docutils literal"><span class="pre">ErrorCell.to_str()</span></tt> which reports
the error string for the cell.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ErrorCell</span><span class="p">(</span> <span class="n">Cell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell which contains an error code.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_digit_str</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="datecell">
<h2>4.12. DateCell<a class="headerlink" href="#datecell" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="cell.DateCell">
<em class="property">class </em><tt class="descclassname">cell.</tt><tt class="descname">DateCell</tt><a class="headerlink" href="#cell.DateCell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">DateCell</span></tt> implements a cell with a proper date-time value.
This is a value which did not come from a workbook float value.</p>
<p>This could be a parsed string, for example.</p>
<p>A variety of conversions make sense for a proper date value.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">DateCell</span><span class="p">(</span> <span class="n">Cell</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cell which contains a proper :mod:`datetime` value.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">to_int</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_float</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">to_float</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">timetuple</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">xl</span><span class="o">=</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">xldate</span><span class="o">.</span><span class="n">xldate_from_datetime_tuple</span><span class="p">(</span>
            <span class="n">timetuple</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workbook</span><span class="o">.</span><span class="n">datemode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xl</span>
    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">0</span> <span class="p">):</span>
        <span class="n">fmt</span><span class="o">=</span> <span class="s">&quot;{0:0.{digits}f}&quot;</span>
        <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">(</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_float</span><span class="p">(),</span><span class="n">digits</span><span class="o">=</span><span class="n">digits</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_str</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">to_datetime</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="bp">None</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
    <span class="k">def</span> <span class="nf">to_digit_str</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">):</span>
        <span class="n">fmt</span><span class="o">=</span> <span class="s">&quot;{{0:0&gt;{0}d}}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_int</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>For numbers, the <tt class="docutils literal"><span class="pre">&lt;d&gt;</span></tt> cells have a native date format.</p>
<p>This is an extension to basic <tt class="xref py py-mod docutils literal"><span class="pre">xlrd</span></tt>, XLSX and ODS workbook processing
because no cell has this as its data type.</p>
</div>
<div class="section" id="conversion-functions">
<h2>4.13. Conversion Functions<a class="headerlink" href="#conversion-functions" title="Permalink to this headline">¶</a></h2>
<p>There is a need for functions for various kinds of conversions.  These are
mostly focused on processing Fixed format files, where the data all originates
as text.</p>
<p>These can also be applied to CSV or TAB files to create cells other than the default
<a class="reference internal" href="#cell.TextCell" title="cell.TextCell"><tt class="xref py py-class docutils literal"><span class="pre">cell.TextCell</span></tt></a>.</p>
<div class="section" id="dates">
<h3>4.13.1. Dates<a class="headerlink" href="#dates" title="Permalink to this headline">¶</a></h3>
<p>The function <a class="reference internal" href="#cell.date_from_string" title="cell.date_from_string"><tt class="xref py py-func docutils literal"><span class="pre">date_from_string()</span></tt></a> is a closure based on a format string
that returns a single-argument conversion function.</p>
<dl class="function">
<dt id="cell.date_from_string">
<tt class="descclassname">cell.</tt><tt class="descname">date_from_string</tt><big>(</big><em>format</em><big>)</big><a class="headerlink" href="#cell.date_from_string" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">date_from_string</span><span class="p">(</span> <span class="n">format</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">the_conversion</span><span class="p">(</span> <span class="n">string</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span> <span class="n">string</span><span class="p">,</span> <span class="n">format</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">the_conversion</span>
</pre></div>
</div>
<p>This forms the factory for the <a class="reference internal" href="#cell.DateCell" title="cell.DateCell"><tt class="xref py py-class docutils literal"><span class="pre">cell.DateCell</span></tt></a> class.</p>
<dl class="function">
<dt id="cell.datecell_from_string">
<tt class="descclassname">cell.</tt><tt class="descname">datecell_from_string</tt><big>(</big><em>format</em><big>)</big><a class="headerlink" href="#cell.datecell_from_string" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">datecell_from_string</span><span class="p">(</span> <span class="n">format</span> <span class="p">):</span>
    <span class="n">dt_conv</span><span class="o">=</span> <span class="n">date_from_string</span><span class="p">(</span> <span class="n">format</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">the_conversion</span><span class="p">(</span> <span class="n">string</span><span class="p">,</span> <span class="n">workbook</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">DateCell</span><span class="p">(</span> <span class="n">dt_conv</span><span class="p">(</span> <span class="n">string</span> <span class="p">),</span> <span class="n">workbook</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">the_conversion</span>
</pre></div>
</div>
<p>This could be used like this in a schema definition.</p>
<div class="highlight-python"><div class="highlight"><pre>d = Attribute( name=&quot;mm-dd-yy&quot;, size=*n*, offset=*m*,
    create=stingray.cell.datecell_from_string(&quot;%m/%d/%y&quot;) )
</pre></div>
</div>
<p>The function <a class="reference internal" href="#cell.date_from_float" title="cell.date_from_float"><tt class="xref py py-func docutils literal"><span class="pre">date_from_float()</span></tt></a> is an additional closure based on a <tt class="docutils literal"><span class="pre">workbook.datemode</span></tt> that returns a single-argument conversion function.</p>
<dl class="function">
<dt id="cell.date_from_float">
<tt class="descclassname">cell.</tt><tt class="descname">date_from_float</tt><big>(</big><em>format</em><big>)</big><a class="headerlink" href="#cell.date_from_float" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">date_from_float</span><span class="p">(</span> <span class="n">datemode</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">the_conversion</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dt</span><span class="o">=</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">xldate_as_tuple</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datemode</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">xlrd</span><span class="o">.</span><span class="n">xldate</span><span class="o">.</span><span class="n">XLDateAmbiguous</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">ex</span><span class="o">=</span> <span class="ne">ValueError</span><span class="p">(</span> <span class="s">&quot;Ambiguous Date: {0!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">ex</span><span class="o">.</span><span class="n">__cause__</span><span class="o">=</span> <span class="n">e</span>
            <span class="k">raise</span> <span class="n">ex</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">dt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">the_conversion</span>
</pre></div>
</div>
<p>This function has similar applications for converting data to a more useful
<a class="reference internal" href="#cell.DateCell" title="cell.DateCell"><tt class="xref py py-class docutils literal"><span class="pre">cell.DateCell</span></tt></a> instance.</p>
<div class="highlight-python"><div class="highlight"><pre>float2date= stingray.cell.date_from_float(workbook.datemode)
d = Attribute( name=&quot;mm-dd-yy&quot;, size=*n*, offset=*m*,
    create=lambda x, w: stingray.cell.DateCell( float2date(x), w ) )
</pre></div>
</div>
</div>
<div class="section" id="numbers">
<h3>4.13.2. Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h3>
<p>A fixed-format file can have any of a variety of numbers, encoded in a
variety of ways.</p>
<p>The ordinary number-as-string, is trivially handled by <a class="reference internal" href="#cell.TextCell" title="cell.TextCell"><tt class="xref py py-class docutils literal"><span class="pre">cell.TextCell</span></tt></a>.  No real need for a more sophisticated conversion.</p>
<p>The less-ordinary case of COBOL data, in computational-3 format, or display
format with an assumed decimal place is more difficult.  We&#8217;ll defer
this to <a class="reference internal" href="cobol.html#cobol"><em>The COBOL Package</em></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/Stingray_belon1553_small.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. Cell Module &#8211; Data Element Containers and Conversions</a><ul>
<li><a class="reference internal" href="#capture-use-case">4.1. Capture Use Case</a></li>
<li><a class="reference internal" href="#convert-use-cases">4.2. Convert Use Cases</a></li>
<li><a class="reference internal" href="#model">4.3. Model</a></li>
<li><a class="reference internal" href="#overheads">4.4. Overheads</a></li>
<li><a class="reference internal" href="#cell">4.5. Cell</a></li>
<li><a class="reference internal" href="#emptycell">4.6. EmptyCell</a></li>
<li><a class="reference internal" href="#textcell">4.7. TextCell</a></li>
<li><a class="reference internal" href="#numbercell">4.8. NumberCell</a></li>
<li><a class="reference internal" href="#floatdatecell">4.9. FloatDateCell</a></li>
<li><a class="reference internal" href="#booleancell">4.10. BooleanCell</a></li>
<li><a class="reference internal" href="#errorcell">4.11. ErrorCell</a></li>
<li><a class="reference internal" href="#datecell">4.12. DateCell</a></li>
<li><a class="reference internal" href="#conversion-functions">4.13. Conversion Functions</a><ul>
<li><a class="reference internal" href="#dates">4.13.1. Dates</a></li>
<li><a class="reference internal" href="#numbers">4.13.2. Numbers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="stingray_init.html"
                        title="previous chapter">3.1. stingray <tt class="docutils literal"><span class="pre">__init__.py</span></tt></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="sheet.html"
                        title="next chapter">5. Sheet Module &#8211; Sheet and Row Access</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/cell.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="sheet.html" title="5. Sheet Module – Sheet and Row Access"
             >next</a> |</li>
        <li class="right" >
          <a href="stingray_init.html" title="3.1. stingray __init__.py"
             >previous</a> |</li>
        <li><a href="index.html">The Stingray Schema-Based File Reader</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, S. Lott.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>