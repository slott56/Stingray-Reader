<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>14.8. COBOL Schema Loader Unit Tests &mdash; The Stingray Schema-Based File Reader</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '4.4.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="The Stingray Schema-Based File Reader" href="../index.html" />
    <link rel="up" title="14. Testing" href="index.html" />
    <link rel="next" title="14.9. COBOL Integration Tests" href="cobol_2.html" />
    <link rel="prev" title="14.7. COBOL Schema Testing" href="cobol.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cobol_2.html" title="14.9. COBOL Integration Tests"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cobol.html" title="14.7. COBOL Schema Testing"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">The Stingray Schema-Based File Reader</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">14. Testing</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="cobol-schema-loader-unit-tests">
<h1>14.8. COBOL Schema Loader Unit Tests<a class="headerlink" href="#cobol-schema-loader-unit-tests" title="Permalink to this headline">¶</a></h1>
<p>These are unit tests of various parts of the COBOL schema loader.  See <a class="reference internal" href="../cobol_loader.html#cobol-loader"><em>COBOL Loader Module &#8211; Parse COBOL Source to Load a Schema</em></a>.</p>
<div class="section" id="overheads">
<h2>14.8.1. Overheads<a class="headerlink" href="#overheads" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;stingray.cobol.loader Unit Tests.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">stingray.cobol.loader</span>
<span class="kn">import</span> <span class="nn">weakref</span>
</pre></div>
</div>
</div>
<div class="section" id="lexical-scanner">
<h2>14.8.2. Lexical Scanner<a class="headerlink" href="#lexical-scanner" title="Permalink to this headline">¶</a></h2>
<p>At a low-level, a parser requires a lexical scanner to break the input into
discrete tokens.  In the case of COBOL, there are mercifully few rules to
follow.</p>
<p>A few test cases will demonstrate that line-ending <tt class="docutils literal"><span class="pre">.</span></tt> as well as
a simple version of COBOL quoting rules are followed.  The full COBOL language
isn&#8217;t being parsed, just the part of the language used for DDE&#8217;s.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestLexicalScanner</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_should_scan</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy1</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      * COPY1.COB</span>
<span class="s">       01  DETAIL-LINE.</span>
<span class="s">           05                              PIC X(7).</span>
<span class="s">           05  QUESTION                    PIC ZZ.</span>
<span class="s">           05                              PIC X(6).</span>
<span class="s">           05  PRINT-YES                   PIC ZZ.</span>
<span class="s">           05                              PIC X(3).</span>
<span class="s">         SKIP2</span>
<span class="s">           05  PRINT-NO                    PIC ZZ.</span>
<span class="s">           05                              PIC X(6).</span>
<span class="s">           05  NOT-SURE                    PIC ZZ.</span>
<span class="s">           05                              PIC X(7).</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;DETAIL-LINE&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(7)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;QUESTION&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(6)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PRINT-YES&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(3)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PRINT-NO&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(6)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;NOT-SURE&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(7)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy1</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_scan_pic</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy2</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      * COPY2.COB</span>
<span class="s">       01  DETAIL-LINE.</span>
<span class="s">           05  FANCY-FORMAT                PIC 9(7).99.</span>
<span class="s">           05  SSN-FORMAT                  PIC 999-99-9999.</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;DETAIL-LINE&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;FANCY-FORMAT&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;9(7).99&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;SSN-FORMAT&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;999-99-9999&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy2</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_scan_quotes</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy3</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      * COPY3.COB</span>
<span class="s">       01  SIMPLE-LINE.</span>
<span class="s">           05  VALUE-1                PIC X(10) VALUE &#39;STRING    &#39;.</span>
<span class="s">           05  VALUE-2                PIC X(10) VALUE &quot;STRING    &quot;.</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span> <span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;SIMPLE-LINE&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;VALUE-1&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;STRING    &#39;&quot;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;VALUE-2&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;STRING    &quot;&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy3</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_should_replace_text</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy4</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      * COPY4.COB</span>
<span class="s">       01  &#39;XY&#39;-SIMPLE-LINE.</span>
<span class="s">           05  &#39;XY&#39;-VALUE-1                PIC X(10) VALUE &#39;STRING    &#39;.</span>
<span class="s">           05  &#39;XY&#39;-VALUE-2                PIC X(10) VALUE &quot;STRING    &quot;.</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span> <span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;AB-SIMPLE-LINE&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;AB-VALUE-1&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s">&quot;&#39;STRING    &#39;&quot;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;AB-VALUE-2&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(10)&#39;</span><span class="p">,</span> <span class="s">&#39;VALUE&#39;</span><span class="p">,</span> <span class="s">&#39;&quot;STRING    &quot;&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer</span><span class="p">(</span><span class="n">replacing</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;&#39;XY&#39;&quot;</span><span class="p">,</span><span class="s">&quot;AB&quot;</span><span class="p">)])</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="n">copy4</span> <span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="long-lexical-scanner">
<h2>14.8.3. Long Lexical Scanner<a class="headerlink" href="#long-lexical-scanner" title="Permalink to this headline">¶</a></h2>
<p>Some copybooks have junk at the left and right on each line of source.
A separate subclass can handle this.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestLongLexicalScanner</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy1</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s">      **************************************************************</span>
<span class="s">       01  REPORT-TAPE-DETAIL-RECORD.</span>
<span class="s">           02  RDT-REC-CODE-BYTES.                                      00000130</span>
<span class="s">       EJECT</span>
<span class="s">               03  RDT-REC-CODE-KEY              PIC X.                 00000140</span>
<span class="s">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanner</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Lexer_Long_Lines</span><span class="p">()</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy1</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_scan</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;REPORT-TAPE-DETAIL-RECORD&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;02&#39;</span><span class="p">,</span> <span class="s">&#39;RDT-REC-CODE-BYTES&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;03&#39;</span><span class="p">,</span> <span class="s">&#39;RDT-REC-CODE-KEY&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">scanner</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">tokens</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="picture-parsing">
<h2>14.8.4. Picture Parsing<a class="headerlink" href="#picture-parsing" title="Permalink to this headline">¶</a></h2>
<p>A picture clause has it&#8217;s own &#8220;sub-language&#8221; for describing an elementary
piece of data.  From the picture clause, we extract a number of features.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">final:</th><td class="field-body">final picture with ()&#8217;s expanded.</td>
</tr>
<tr class="field-even field"><th class="field-name">alpha:</th><td class="field-body">boolean alpha = True, numeric = False.</td>
</tr>
<tr class="field-odd field"><th class="field-name">length:</th><td class="field-body">len(final)</td>
</tr>
<tr class="field-even field"><th class="field-name">scale:</th><td class="field-body">count of &#8220;P&#8221; positions</td>
</tr>
<tr class="field-odd field"><th class="field-name">precision:</th><td class="field-body">digits to the right of the decimal point</td>
</tr>
<tr class="field-even field"><th class="field-name">signed:</th><td class="field-body">boolean</td>
</tr>
<tr class="field-odd field"><th class="field-name">decimal:</th><td class="field-body">&#8221;.&#8221; or &#8220;V&#8221; or None</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestPictureParser</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_should_expand</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;X(7)&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;XXXXXXX&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_z</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;ZZ&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;ZZ&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_9</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;999&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_complex</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;9(5)V99&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;9999999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_signed</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;S9(7)V99&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;999999999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_db</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;DB9(5).99&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;DB99999.99&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_signed_and_v</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;S9(4)V&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;9999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;V&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_handle_multiple_repeats</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">pic</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">picture_parser</span><span class="p">(</span> <span class="s">&quot;9(6).9(3)&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;999999.999&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">final</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">alpha</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">length</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">scale</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">precision</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span> <span class="n">pic</span><span class="o">.</span><span class="n">signed</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;.&quot;</span><span class="p">,</span> <span class="n">pic</span><span class="o">.</span><span class="n">decimal</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>14.8.5. Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>A Usage object is attached to a DDE to explain how to decode the bytes
that will be found in the record.  There are many cases in COBOL, but we only
really care about three: DISPLAY, COMP and COMP-3.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestUsageDisplay</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UsageDisplay</span><span class="p">(</span> <span class="s">&quot;DISPLAY&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s">&quot;99999&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;V&quot;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;DISPLAY&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>Note the sizing issue for COMP:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="81%" />
<col width="19%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Picture Info</th>
<th class="head">Bytes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>if  1&lt;=(int+fract)&lt;=4</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>if  5&lt;=(int+fract)&lt;=9</td>
<td>4</td>
</tr>
<tr class="row-even"><td>if 10&lt;=(int+fract)&lt;=18</td>
<td>8</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestUsageComp</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UsageComp</span><span class="p">(</span> <span class="s">&quot;COMP&quot;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size_999</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s">&quot;999&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;COMP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size_S9_4</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s">&quot;9999&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;V&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;COMP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size_S9_5</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s">&quot;99999&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;V&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;COMP&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestUsageComp3</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UsageComp3</span><span class="p">(</span> <span class="s">&quot;COMP-3&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">Picture</span><span class="p">(</span> <span class="s">&quot;9999999&quot;</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&quot;V&quot;</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_show_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="allocation">
<h2>14.8.6. Allocation<a class="headerlink" href="#allocation" title="Permalink to this headline">¶</a></h2>
<p>There are three kinds: group (i.e., a header under a group), successor,
and redefines.</p>
<p>A Redefines object gets the offset information from another named element.
A Group object
for an item.  A non-redefined element is &#8220;real&#8221;: it has a proper size and offset.</p>
<p>An item with a REDEFINES
clause is an alias for another element.   The offset comes from the other element.  The size is reported as zero to simplify offset calculations.</p>
<p>Here&#8217;s a Mock DDE which can have a redefines clause, or be referenced by
a redefines clause.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MockDDE</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="c"># default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kw</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">child</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
</pre></div>
</div>
<p>There are two non-redefinies cases: Successor and Group. The DDE stands for itself.  The size is
as computed.  The offset is as generated by the <a class="reference internal" href="../cobol_defs.html#cobol.defs.setSizeAndOffset" title="cobol.defs.setSizeAndOffset"><tt class="xref py py-func docutils literal"><span class="pre">cobol.defs.setSizeAndOffset()</span></tt></a> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestAllocation_Group</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">123</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">123</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_get_size_and_offset</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">123</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">totalSize</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">dde</span><span class="p">()</span> <span class="p">)</span>

<span class="k">class</span> <span class="nc">TestAllocation_Successor</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">12</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">5</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successor</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">successor</span><span class="p">,</span> <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">7</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_get_size_and_offset</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successor</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">totalSize</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">dde</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>Redefines is a reference to another DDE. The other DDE is located by the resolver pass.
The size and offset come from the other element.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestAllocation_Rdefines</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span> <span class="s">&quot;TOP&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">12</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">otherdde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span> <span class="s">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">23</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">otherdde</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">redefines_some_name</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">(</span> <span class="s">&quot;SOME-NAME&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">=</span> <span class="n">MockDDE</span><span class="p">(</span> <span class="n">name</span><span class="o">=</span> <span class="s">&quot;REDEF&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">47</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">redefines_some_name</span><span class="p">,</span> <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_get_size_and_offset</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Since this redefines something else, it doesn&#39;t contribute any size.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redefines_some_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">totalSize</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">23</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">dde</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="size-and-offset-function">
<h2>14.8.7. Size And Offset Function<a class="headerlink" href="#size-and-offset-function" title="Permalink to this headline">¶</a></h2>
<p>The idea is that this function does a depth-first traversal to accumulate the
size in each group-level DDE.</p>
<div class="section" id="size-and-offset-mocks">
<h3>14.8.7.1. Size and Offset Mocks<a class="headerlink" href="#size-and-offset-mocks" title="Permalink to this headline">¶</a></h3>
<p>To test size and offset function, we need a number of mocks.
We need to mock a DDE.   Plus,
we need to mock Usage and Redefines classes, also.</p>
<p>We also mock the iterable protocol of the DDE.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MockDDE2</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occurs</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">=</span> <span class="s">&quot;FILLER&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizeScalePrecision</span><span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensionality</span><span class="o">=</span> <span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kw</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">length</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">rc</span><span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="p">,</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">):</span>
            <span class="n">rc</span><span class="o">=</span> <span class="s">&quot;REDEFINES {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="n">oc</span><span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occurs</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;{0} {1} {2} {3} {4}.  {5} {6}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">picture</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">oc</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>  <span class="p">)</span>
    <span class="k">def</span> <span class="nf">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">child</span> <span class="p">):</span>
        <span class="n">child</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">child</span> <span class="p">)</span>
        <span class="n">child</span><span class="o">.</span><span class="n">indent</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span> <span class="k">return</span> <span class="n">d</span>
    <span class="k">def</span> <span class="nf">pathTo</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">c_i</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">c_i</span>

<span class="k">class</span> <span class="nc">MockUsage</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">MockCell</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">buffer</span><span class="p">,</span> <span class="n">workbook</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="o">=</span> <span class="nb">buffer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">workbook</span><span class="o">=</span> <span class="n">workbook</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_</span><span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typeInfo</span><span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">kw</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span>
    <span class="k">def</span> <span class="nf">setTypeInfo</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">picture</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typeInfo</span><span class="o">=</span> <span class="n">picture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">=</span> <span class="n">picture</span><span class="o">.</span><span class="n">length</span>
    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_</span>
    <span class="k">def</span> <span class="nf">create_func</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">raw</span><span class="p">,</span> <span class="n">workbook</span><span class="p">,</span> <span class="n">attr</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">MockUsage</span><span class="o">.</span><span class="n">MockCell</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">workbook</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">mock_resolver</span><span class="p">(</span> <span class="n">top</span> <span class="p">):</span>
    <span class="k">for</span> <span class="n">aDDE</span> <span class="ow">in</span> <span class="n">top</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">aDDE</span><span class="o">.</span><span class="n">allocation</span><span class="p">:</span>
            <span class="n">aDDE</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span> <span class="n">aDDE</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># Not setup by test.</span>
            <span class="c">#aDDE.allocation= stingray.cobol.defs.Group()</span>
            <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="section" id="size-and-offset-cases">
<h3>14.8.7.2. Size and Offset Cases<a class="headerlink" href="#size-and-offset-cases" title="Permalink to this headline">¶</a></h3>
<p>Exercise the size and offset function with a number of cases.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestFlatSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestNestedSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">11</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">16</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">24</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestRedefinesSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-1&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group_1</span> <span class="p">)</span>
        <span class="n">sub_group_2</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-2&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">(</span><span class="n">refers_to</span><span class="o">=</span><span class="n">sub_group_1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-1&quot;</span><span class="p">,),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group_2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">20</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestOccursSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span><span class="p">,</span>
                <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">38</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestGroupOccursSizeOffset</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-1&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group_1</span> <span class="p">)</span>
        <span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span><span class="p">,</span>
                <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">mock_resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_be_repeatable</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="o">*</span><span class="mi">4</span><span class="o">*</span><span class="mi">5</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">totalSize</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="resolve-redefines">
<h2>14.8.8. Resolve Redefines<a class="headerlink" href="#resolve-redefines" title="Permalink to this headline">¶</a></h2>
<p>We need to test the <tt class="xref py py-func docutils literal"><span class="pre">cobol.loader.resolver()</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestRedefinesNameResolver</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-1&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-2&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Redefines</span><span class="p">(</span><span class="n">refers_to</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP-1&quot;</span><span class="p">,),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;9999999&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXXXXXX&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">search</span><span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;GROUP-1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="p">,</span>
            <span class="s">&#39;GROUP-2&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="p">,</span>
            <span class="p">}</span>

    <span class="k">def</span> <span class="nf">test_should_resolve</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">resolver</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub_group_2</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">refers_to</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="set-dimensionality">
<h2>14.8.9. Set Dimensionality<a class="headerlink" href="#set-dimensionality" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="xref py py-func docutils literal"><span class="pre">stingray.cobol.defs.setDimensionality()</span></tt> function pushes the OCCURS information down to each
child of the OCCURS. This builds the effective dimensionality of the lowest-level
elements.</p>
<div class="highlight-cobol"><div class="highlight"><pre><span class="c">* COPY</span><span class="mi">3</span><span class="p">.</span><span class="nv">COB</span>
<span class="c"> 01  S</span><span class="nv">URVEY-RESPONSES</span><span class="p">.</span>
<span class="c">     0</span><span class="mi">5  </span><span class="nv">QUESTION-NUMBER</span>         <span class="kp">OCCURS</span> <span class="mi">10 </span><span class="kp">TIMES</span><span class="p">.</span>
<span class="c">      </span>   <span class="mi">10  </span><span class="nv">RESPONSE-CATEGORY</span>     <span class="kp">OCCURS</span> <span class="mi">3 </span><span class="kp">TIMES</span><span class="p">.</span>
<span class="c">      </span>       <span class="mi">15  </span><span class="nv">ANSWER</span>                          <span class="kt">PIC 99</span><span class="p">.</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Test_Dimensionality</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;SURVEY-RESPONSES&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">parent</span><span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span> <span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;QUESTION-NUMBER&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">6</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span> <span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;RESPONSE-CATEGORY&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">),</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">OccursFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span> <span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;15&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ANSWER&#39;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99&quot;</span><span class="p">,</span>
            <span class="n">occurs</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Occurs</span><span class="p">(),</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totalSize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;99&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_dimensions</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setDimensionality</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="p">,),</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group_05</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">group_10</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_15</span><span class="o">.</span><span class="n">dimensionality</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="dde-construction-methods">
<h2>14.8.10. DDE Construction Methods<a class="headerlink" href="#dde-construction-methods" title="Permalink to this headline">¶</a></h2>
<p>DDE class has many methods.  They fit into three functionality categories.</p>
<ol class="arabic simple">
<li>Building the DDE, adding children, visiting.</li>
<li>Getting elements by simple name.  Computing path names.  Getting elements by path name.</li>
<li>Getting a run-time value from a buffer, accounting for indexes.  This
is DDE Access and is tested separately.</li>
</ol>
<p>The first two areas are tested here.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestDDEMethods</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">DDE</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;TOP&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">DDE</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">DDE</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ELEMENT&#39;</span><span class="p">,</span> <span class="n">pic</span><span class="o">=</span><span class="s">&#39;X(5)&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_structure</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_path_name</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;TOP.GROUP.ELEMENT&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">pathTo</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">getPath</span><span class="p">(</span><span class="s">&quot;TOP.GROUP.ELEMENT&quot;</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">g</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&quot;GROUP&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">g</span> <span class="p">)</span>
        <span class="n">e</span><span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&quot;ELEMENT&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">e</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-single-dde">
<h2>14.8.11. Parsing Single DDE<a class="headerlink" href="#parsing-single-dde" title="Permalink to this headline">¶</a></h2>
<p>The parser handles 11 different clauses.  Additionally, it makes a single
DDE element as well as making a composite DDE record.  A parser depends on
a lexical scanner.  However, since our scanner is essentially an iterator,
we don&#8217;t need to do very much to mock it.</p>
<p>To test just the <a class="reference internal" href="../cobol_loader.html#cobol.loader.RecordFactory" title="cobol.loader.RecordFactory"><tt class="xref py py-class docutils literal"><span class="pre">cobol.loader.RecordFactory</span></tt></a>
in isolation, we need to provide mocks for a large number of dependenices.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">redefines_class</span><span class="o">=</span> <span class="n">Redefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">non_redefines_class</span><span class="o">=</span> <span class="n">NonRedefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">UsageDisplay</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">UsageComp</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">UsageComp3</span>
</pre></div>
</div>
<p>Note that there are numerous syntax errors which we do not test for.
Ideally, a DDE clause is used in working software, and passes through a COBOL compiler.  This isn&#8217;t <em>lint for COBOL</em>.</p>
<p>We have three test cases: things the parser finds (and keeps), things
the parser skips gracefully, and things we can&#8217;t cope with.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestParser</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
        <span class="c">#self.parser.redefines_class= MockRedefines</span>
        <span class="c">#self.parser.non_redefines_class= MockNonRedefine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">MockUsage</span>
    <span class="k">def</span> <span class="nf">test_should_parse_group</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">source</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;01&quot;</span><span class="p">,</span> <span class="s">&quot;GROUP&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;GROUP&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_filler</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">source</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;FILLER&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_name</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">source</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;ELEMENTARY&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">source</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;ELEMENTARY&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_occurs</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;ELEMENTARY-OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;S9999&quot;</span><span class="p">,</span> <span class="s">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;ELEMENTARY-OCCURS&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;S9999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;GROUP-OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;7&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;INDEXED&quot;</span><span class="p">,</span> <span class="s">&quot;BY&quot;</span><span class="p">,</span> <span class="s">&quot;IRRELEVANT&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;GROUP-OCCURS&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_picture</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Details of picture clause tested separately.&quot;&quot;&quot;</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;ELEMENTARY-PIC&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;S9999.999&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;ELEMENTARY-PIC&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;S9999.999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_redefines</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;ELEMENTARY-REDEF&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;S9999&quot;</span><span class="p">,</span> <span class="s">&quot;REDEFINES&quot;</span><span class="p">,</span> <span class="s">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;ELEMENTARY-REDEF&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;S9999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;GROUP-REDEF&quot;</span><span class="p">,</span> <span class="s">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;7&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;REDEFINES&quot;</span><span class="p">,</span> <span class="s">&quot;ANOTHER-NAME&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;GROUP-REDEF&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;ANOTHER-NAME&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_usage</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;USE-DISPLAY&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;S9999&quot;</span><span class="p">,</span> <span class="s">&quot;USAGE&quot;</span><span class="p">,</span> <span class="s">&quot;DISPLAY&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;USE-DISPLAY&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;S9999&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;DISPLAY&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;USE-COMP-3&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;S9(7)V99&quot;</span><span class="p">,</span> <span class="s">&quot;USAGE&quot;</span><span class="p">,</span> <span class="s">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;USE-COMP-3&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;S9(7)V99&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">src3</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;USE-COMP-3-ALT&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;S9(9)V99&quot;</span><span class="p">,</span> <span class="s">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src3</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;USE-COMP-3-ALT&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;S9(9)V99&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;COMP-3&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_depending_on_1</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;DEP-1&quot;</span><span class="p">,</span> <span class="s">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="s">&quot;TO&quot;</span><span class="p">,</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;DEPENDING&quot;</span><span class="p">,</span> <span class="s">&quot;ON&quot;</span><span class="p">,</span> <span class="s">&quot;ODO-1&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;DEP-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;ODO-1&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span> <span class="c"># number(None) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_parse_depending_on_2</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;DEP-2&quot;</span><span class="p">,</span> <span class="s">&quot;OCCURS&quot;</span><span class="p">,</span> <span class="s">&quot;TO&quot;</span><span class="p">,</span> <span class="s">&quot;5&quot;</span><span class="p">,</span> <span class="s">&quot;TIMES&quot;</span><span class="p">,</span> <span class="s">&quot;DEPENDING&quot;</span><span class="p">,</span> <span class="s">&quot;ON&quot;</span><span class="p">,</span> <span class="s">&quot;ODO-2&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;DEP-2&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;ODO-2&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span> <span class="c"># number(None) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
</pre></div>
</div>
<p>Syntax which is silently skipped.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestParserSkip</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">test_should_skip_blank</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;BLANK-ZERO-1&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;BLANK&quot;</span><span class="p">,</span> <span class="s">&quot;ZERO&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;BLANK-ZERO-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;BLANK-ZERO-2&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;BLANK&quot;</span><span class="p">,</span> <span class="s">&quot;WHEN&quot;</span><span class="p">,</span> <span class="s">&quot;ZEROES&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;BLANK-ZERO-2&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_skip_justified</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;JUST-RIGHT-1&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;JUST&quot;</span><span class="p">,</span> <span class="s">&quot;RIGHT&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;JUST-RIGHT-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;JUST-RIGHT-2&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;JUSTIFIED&quot;</span><span class="p">,</span> <span class="s">&quot;RIGHT&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;JUST-RIGHT-2&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_skip_value</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;VALUE-1&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(8)&quot;</span><span class="p">,</span> <span class="s">&quot;VALUE&quot;</span><span class="p">,</span> <span class="s">&quot;&#39;10 CHARS&#39;&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&#39;VALUE-1&#39;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(8)&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">allocation</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span> <span class="n">dde</span><span class="o">.</span><span class="n">initValue</span> <span class="p">)</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Test EXTERNAL, GLOBAL as Skipped Words, too.</p>
</div>
<p>A few clauses may be relevant for some kinds of DDE&#8217;s.  These
can impact the encoding of the bytes.  We don&#8217;t parse
them, however, because they are rarely seen in the wild.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestParserException</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">test_should_fail_renames</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;66&quot;</span><span class="p">,</span> <span class="s">&quot;BLANK-ZERO-1&quot;</span><span class="p">,</span> <span class="s">&quot;RENAMES&quot;</span><span class="p">,</span> <span class="s">&quot;SOME-NAME&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarns</span><span class="p">(</span> <span class="ne">UserWarning</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">))</span> <span class="p">)</span>
        <span class="c"># Alternative RENAMES</span>
        <span class="c"># self.assertRaises( stingray.cobol.defs.UnsupportedError, ...</span>
    <span class="k">def</span> <span class="nf">test_should_fail_sign</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;SIGN-1&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;LEADING&quot;</span><span class="p">,</span> <span class="s">&quot;SIGN&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">src2</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;SIGN-2&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;TRAILING&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src2</span><span class="p">))</span> <span class="p">)</span>
        <span class="n">src3</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;SIGN-3&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;SIGN&quot;</span><span class="p">,</span> <span class="s">&quot;IS&quot;</span><span class="p">,</span> <span class="s">&quot;SEPARATE&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src3</span><span class="p">))</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_fail_synchronized</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">src1</span><span class="o">=</span> <span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="s">&quot;SYNC-1&quot;</span><span class="p">,</span> <span class="s">&quot;PIC&quot;</span><span class="p">,</span> <span class="s">&quot;X(10)&quot;</span><span class="p">,</span> <span class="s">&quot;SYNCHRONIZED&quot;</span><span class="p">,</span> <span class="s">&quot;.&quot;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">UnsupportedError</span><span class="p">,</span> <span class="nb">next</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">dde_iter</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">src1</span><span class="p">))</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parsing-complete-dde">
<h2>14.8.12. Parsing Complete DDE<a class="headerlink" href="#parsing-complete-dde" title="Permalink to this headline">¶</a></h2>
<p>Parsing a complete DDE is a multi-step dance.  First, parse all the clauses.
Then apply some standard functions to resolve the REDEFINES clauses
as well as compute sizes and offsets.</p>
<p>To test just the <a class="reference internal" href="../cobol_loader.html#cobol.loader.RecordFactory" title="cobol.loader.RecordFactory"><tt class="xref py py-class docutils literal"><span class="pre">cobol.loader.RecordFactory</span></tt></a>
in isolation, we need to provide mocks for a large number of dependenices.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Built during the parsing</span>
<span class="bp">self</span><span class="o">.</span><span class="n">redefines_class</span><span class="o">=</span> <span class="n">Redefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">non_redefines_class</span><span class="o">=</span> <span class="n">NonRedefines</span>
<span class="bp">self</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">UsageDisplay</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">UsageComp</span>
<span class="bp">self</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">UsageComp3</span>
</pre></div>
</div>
<p>We use dependency injection here to tease apart Redefines and Usage classes.
We can use existing mocks for this.</p>
<p>Here&#8217;s a test of the &#8220;main&#8221; method for parsing a record.
Note that <tt class="xref py py-meth docutils literal"><span class="pre">stingray.cobol.loader.RecordFactory.makeRecord()</span></tt> is
iterable, so we make a list and take the first element.</p>
<p>We could as easily  <tt class="docutils literal"><span class="pre">next()</span></tt> it to get the first element.</p>
<p>Test the parser</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestCompleteParser</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">RecordFactory</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">display_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp_class</span><span class="o">=</span> <span class="n">MockUsage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">comp3_class</span><span class="o">=</span> <span class="n">MockUsage</span>
    <span class="k">def</span> <span class="nf">test_should_parse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">copy1</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">              * COPY1.COB</span>
<span class="s">               01  DETAIL-LINE.</span>
<span class="s">                   05                              PIC X(7).</span>
<span class="s">                   05  QUESTION                    PIC ZZ.</span>
<span class="s">                   05                              PIC X(6).</span>
<span class="s">                   05  PRINT-YES                   PIC ZZ.</span>
<span class="s">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lex</span><span class="o">=</span> <span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="s">&#39;DETAIL-LINE&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(7)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;QUESTION&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;X(6)&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span>
        <span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="s">&#39;PRINT-YES&#39;</span><span class="p">,</span> <span class="s">&#39;PIC&#39;</span><span class="p">,</span> <span class="s">&#39;ZZ&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">]</span>
        <span class="n">dde</span><span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">makeRecord</span><span class="p">(</span> <span class="nb">iter</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lex</span> <span class="p">)</span> <span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;01&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;DETAIL-LINE&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">c0</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;FILLER&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(7)&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c0</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">c1</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;QUESTION&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;ZZ&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c1</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">c2</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;FILLER&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;X(6)&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c2</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">c3</span><span class="o">=</span> <span class="n">dde</span><span class="o">.</span><span class="n">top</span><span class="p">()</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;05&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">level</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;PRINT-YES&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;ZZ&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">picture</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c3</span><span class="o">.</span><span class="n">occurs</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dde</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="schema-maker">
<h2>14.8.13. Schema Maker<a class="headerlink" href="#schema-maker" title="Permalink to this headline">¶</a></h2>
<p>A DDE is tranformed into a flat schema from the highly-nested DDE structure
via the <tt class="xref py py-func docutils literal"><span class="pre">stingray.cobol.loader.make_schema()</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestNestedSchemaMaker</span><span class="p">(</span> <span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;01&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;TOP&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">top</span><span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;FIRST&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXX&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;SECOND&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">5</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;99999&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">3</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">=</span> <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;GROUP&quot;</span><span class="p">,</span>
            <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span> <span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span> <span class="n">sub_group</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;INNER&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">7</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Group</span><span class="p">(),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;9999999&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">7</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">sub_group</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;10&#39;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">9</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXXXXXX&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">addChild</span><span class="p">(</span>
            <span class="n">MockDDE2</span><span class="p">(</span> <span class="n">level</span><span class="o">=</span><span class="s">&#39;05&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;LAST&quot;</span><span class="p">,</span> <span class="n">usage</span><span class="o">=</span><span class="n">MockUsage</span><span class="p">(</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">11</span> <span class="p">),</span>
                <span class="n">allocation</span><span class="o">=</span><span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">Successor</span><span class="p">(</span><span class="n">sub_group</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">picture</span><span class="o">=</span><span class="s">&quot;XXXXXXXXXXX&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">24</span> <span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_should_set_size</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">defs</span><span class="o">.</span><span class="n">setSizeAndOffset</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="p">)</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="n">stingray</span><span class="o">.</span><span class="n">cobol</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">make_schema</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="p">]</span> <span class="p">)</span>
        <span class="c">#DEBUG# print( schema )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;TOP&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">35</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;FIRST&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;SECOND&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">3</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="s">&quot;LAST&quot;</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">position</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">24</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">offset</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="n">schema</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="test-suite-and-runner">
<h2>14.8.14. Test Suite and Runner<a class="headerlink" href="#test-suite-and-runner" title="Permalink to this headline">¶</a></h2>
<p>In case we want to build up a larger test suite, we avoid doing
any real work unless this is the main module being executed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">test</span>
<span class="n">suite</span><span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">suite_maker</span><span class="p">(</span> <span class="nb">globals</span><span class="p">()</span> <span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span> <span class="n">__file__</span> <span class="p">)</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">TextTestRunner</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">suite</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/Stingray_belon1553_small.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">14.8. COBOL Schema Loader Unit Tests</a><ul>
<li><a class="reference internal" href="#overheads">14.8.1. Overheads</a></li>
<li><a class="reference internal" href="#lexical-scanner">14.8.2. Lexical Scanner</a></li>
<li><a class="reference internal" href="#long-lexical-scanner">14.8.3. Long Lexical Scanner</a></li>
<li><a class="reference internal" href="#picture-parsing">14.8.4. Picture Parsing</a></li>
<li><a class="reference internal" href="#usage">14.8.5. Usage</a></li>
<li><a class="reference internal" href="#allocation">14.8.6. Allocation</a></li>
<li><a class="reference internal" href="#size-and-offset-function">14.8.7. Size And Offset Function</a><ul>
<li><a class="reference internal" href="#size-and-offset-mocks">14.8.7.1. Size and Offset Mocks</a></li>
<li><a class="reference internal" href="#size-and-offset-cases">14.8.7.2. Size and Offset Cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resolve-redefines">14.8.8. Resolve Redefines</a></li>
<li><a class="reference internal" href="#set-dimensionality">14.8.9. Set Dimensionality</a></li>
<li><a class="reference internal" href="#dde-construction-methods">14.8.10. DDE Construction Methods</a></li>
<li><a class="reference internal" href="#parsing-single-dde">14.8.11. Parsing Single DDE</a></li>
<li><a class="reference internal" href="#parsing-complete-dde">14.8.12. Parsing Complete DDE</a></li>
<li><a class="reference internal" href="#schema-maker">14.8.13. Schema Maker</a></li>
<li><a class="reference internal" href="#test-suite-and-runner">14.8.14. Test Suite and Runner</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cobol.html"
                        title="previous chapter">14.7. COBOL Schema Testing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cobol_2.html"
                        title="next chapter">14.9. COBOL Integration Tests</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/testing/cobol_loader.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cobol_2.html" title="14.9. COBOL Integration Tests"
             >next</a> |</li>
        <li class="right" >
          <a href="cobol.html" title="14.7. COBOL Schema Testing"
             >previous</a> |</li>
        <li><a href="../index.html">The Stingray Schema-Based File Reader</a> &raquo;</li>
          <li><a href="index.html" >14. Testing</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, S. Lott.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>